---
title: "Re-establishment of annual movement trends for a reintroduced long-lived avian species"
date: "`r format(Sys.time(), '%d %B, %Y')`"
author: 
  - David W. Wolfson^[University of Minnesota, Minnesota Cooperative Fish and Wildlife Research Unit], Randall T. Knapik^[Michigan Department of Natural Resources], Anna Buckardt-Thomas^[Iowa Department of Natural Resources], ,  Brian Kiss^[Manitoba Wildlife and Fisheries Branch], Steven Cordts^[Minnesota Department of Natural Resources], Laura Kearns^[Ohio Department of Natural Resources], Tyler Harms^[Iowa Department of Natural Resources], Taylor Finger^[Wisconsin Department of Natural Resources], Sumner Matteson^[Wisconsin Department of Natural Resources], Tiffany Mayo^[Cleveland Metroparks Zoo], Timothy Poole^[Manitoba Wildlife and Fisheries Branch], John Moriarty^[Three Rivers Park District], Margaret Smith^[Trumpeter Swan Society], Christine Herwig^[Minnesota Department of Natural Resources], Drew Fowler^[U.S. Geological Survey, Louisiana Cooperative Fish and Wildlife Research Unit], Thomas R. Cooper^[U.S. Fish and Wildlife Service], John R. Fieberg^[University of Minnesota], David E. Andersen^[U.S. Geological Survey, Minnesota Cooperative Fish and Wildlife Research Unit]
output: 
  bookdown::word_document2:
    fig_caption: yes
    reference_docx: StylesTemplate.docx
    always_allow_html: true
bibliography: "Annual_MVMT_manuscript.bib"
csl: http://www.zotero.org/styles/the-journal-of-wildlife-management
link-citations: yes
editor_options: 
  markdown: 
    wrap: sentence
---

```{r chunk-setup-options, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      message=FALSE,
                      warning=FALSE,
                      fig.cap=TRUE,
                      out.width = '100%',
                      ft.keepnext=FALSE)
```

```{r flextable-settings, include=FALSE}
flextable::set_flextable_defaults(
    font.family = "New Times Roman",
    font.size = 12,
    text.align='center'
  )
```

<!--- this is how to write a comment that won't knit--->

<!--- --->

```{r install packages}
library(bookdown)
library(rmarkdown)
library(here)
library(knitr)
library(tidyverse)
library(flextable)
library(lubridate)
library(ggpubr)
library(patchwork)
```

```{r}
options(scipen = 999)
```

## Abstract

## Introduction

### Biological intro to migration in long-lived avian species

Migration is a behavioral mechanism widely used by all major vertebrate groups (e.g. birds, fish, mammal, herpetofauna) that allows individuals to optimize seasonal availability of resources to increase short-term survival, and by optimizing migration phenology, maximize long-term fitness of the population [@fryxell1988; @milner-gulland2011; @winger2019; @barker2022].
Despite its prevalence as an ecological process and a large body of research involving migration, the establishment of population-level migratory traditions is not well understood [@abrahms2021b].
Reasons for this discrepancy include the challenges of making population-level inference from observations of individuals, quantifying migratory movements along a continuum of variability, and the relative scarcity of successful reintroductions of formerly endangered migratory species [@mueller2011a; @senner2020a].

Similar to other large, long-lived avian species such as geese, cranes and storks, adult swans take care of their young for the first year of life, providing food, protections, and guiding them on their first migration cycle [@chernetsov2004a; @mueller2013].
As a consequence, cultural transmission during the first year is thought to be the primary mechanism that dictates the learned migration patterns used in subsequent years [@sutherland1998].

Although this transfer of information is an effective mechanism for preserving migratory patterns through generations, it is unclear how these trends become established when a formerly extirpated population has been reintroduced on a landscape.
@jesmer2018 found that newly translocated populations initially lost their migratory tendencies and that it took many generations to re-establish such patterns.

### History of IP TRUS decline in NA

Trumpeter swans (*Cygnus buccinator*), the largest waterfowl species in North America, were widespread throughout the continent prior to European colonization during the $19^{th}$ century [@alison1975].
Due to widespread hunting for meat, skins for powder puffs, and feather quills for writing, trumpeter swans were nearly extirpated in the lower 48 states and reached an estimated low of 70 individuals in the 1930s [@banko1960].
Critically low numbers of trumpeter swans led to the establishment of Red Rock Lakes National Wildlife Refuge (RRLNWR) in the confluence of Montana, Wyoming, and Idaho in 1935, which was the last vestige of a sizable breeding swan population in the lower 48 states [@shea2002].

### History of IP TRUS comeback in NA

As trumpeter swan numbers at RRLNWR started to rise, this flock was used as a source population for reintroduction efforts in other parts of the historical breeding range.
Many states translocated trumpeter swans from RRLNWR to augment and boost the abundance and distribution of the diminished Rocky Mountain Population (RMP) or to restore the Interior Population (IP), which had been completely extirpated [@shea2002].
As reintroduction programs further expanded, demand for trumpeter swans outpaced the number available at RRLNWR, and forced managers to search for an alternative source.
In 1959, initial aerial surveys in Alaska discovered over a thousand Pacific Coast Population (PCP) swans [@hansen1971].
Additional surveys in 1968 tallied 2,848 swans, confirming that the population was growing, and that there were sufficient abundance to provide swans for translocations, including to states conducting reintroduction efforts within the IP [@matteson1988].
An important distinction between these source populations is that PCP swans breeding in Alaska migrate to British Columbia and the northwestern United States each winter, but RMP swans from the Tri-State area have lost their migratory tradition [@baskin1993; @oyler-mccance2007].

### Current IP conditions

Estimates of IP abundance have increased dramatically since reintroductions began in the 1960s, and both population size and distribution has expanded significantly [@groves2017].
Trumpeter swans currently breed throughout most of the western Great Lakes region, including in Minnesota, Wisconsin, Michigan, Iowa, Manitoba, Ontario, and Ohio.
However, beyond estimates of population size and trends, there is relatively little recent information about their ecology, including seasonal movements and migration patterns, therefore hindering conservation decision-making.
Current knowledge gaps include the proportion of the IP that remains resident on their breeding range during the winter, the extent (i.e. distance) of movement for those swans that do leave their territories, the timing of the migratory periods (onset in the fall, settlement during winter, arrival in the spring), and how much intra- and inter-individual variability there is in the population.

### Drivers/Why to migrate (or not)

Many factors may influence the decision to leave the breeding territory during the non-breeding season, and how far to migrate for those that leave, and why there may be high among-individual variability even for those breeding at similar locations, including energetics of flight, life history requirements, and knowledge transfer of migratory traditions [@alerstam2003; @dingle2007 @chapman2011].
The energetic cost of migration for a given distance traveled increases non-linearly with the overall weight of the bird, and therefore swans, one of the heaviest avian species to migrate, do so at considerable expense [@pennycuick1989; @berthold2001; @newton2010].
Conversely, according to the 'Thermal Tolerance' or 'Body Size' hypothesis, greater body mass conveys both a higher basal metabolic rate ability to fast, therefore better withstanding harsh winter conditions, and the tendency to migration should decrease with increasing body size [@ketterson1976; @fudickar2013].
Additionally, due to the novelty of persisting in relatively unfamiliar landscapes and the high energetic demand of migration, the non-breeding period typically has the lowest survival rates throughout the annual cycle [@sillett2002; @rushing2017].
Alternatively, migrating to a more temperate area during the wintering period can provide access to food and other resources that allow trumpeter swans to avoid the harshness of winter in the breeding territory [@somveille2015].

Differences in migratory habits may also be due to breeding status, which conveys unique life history requirements, such as early arrival in the spring to defend a breeding territory, lay and incubate eggs, and to stay on the territory late enough in the fall that cygnets learn to fly and develop sufficient fat reserves to migrate south for the winter; all requirements that non-breeding swans will not experience.

It is also likely that the drivers of migration vary within the IP based the location of a swan's breeding territory.
Cues for migration can include declines in available food resources, which may also be affected by density-dependent intra-specific competition [@rappole2013].
Swans that spend the summer at different latitudes will experience varying environmental conditions, such as timing of vegetative greenness or the freeze-up of water on shallow wetlands, which blocks access to submerged vegetation.
The 'push' to avoid the harsh elements of winter will vary substantially throughout different portions of the IP breeding range, and we'd expect the consequences on movement trends to vary concurrently.

### Objectives

To address current information needs, we marked a sample of IP swans with GPS-GSM transmitters to evaluate their movement throughout the annual cycle.
Specifically, we will quantify 1) the proportion of IP that is migratory and the extent of those movements, 2) migration phenology, 3) the role of breeding status and breeding location on annual movement patterns, and 4) the degree of individual and population variability in migration patterns.
Ours is primarily a descriptive study of how a re-established population of trumpeter swans uses a novel landscape.

## Methods

### Study Area

Our study area for swan captures is approximately the current breeding and wintering distribution of IP trumpeter swans (Groves 2017).
We captured all swans on their breeding range except for 4 swans captured on their wintering grounds in Arkansas (Fig. \@ref(fig:capture-map)) .
We deployed transmitters on IP trumpeter swans as far north and west as southern Manitoba (51.1° N, 99.7° W), as far south as central Arkansas (35.5° N, 91.9° W), and as far east as central Ohio (40.6° N, 82.7° W).
Capture locations occurred in a mix of Laurentian Mixed Forest, Prairie Parkland, Eastern Broadleaf Forest, and Aspen Parklands [@cleland1997].

```{r capture-map, fig.align="left", fig.cap="Insert caption for capture location map here..."}

 knitr::include_graphics(here("figures/figs_for_manuscript/capture_locations_with_ar.tiff"))
```

### Capture and Handling

We captured all swans (except for 4 captured using snares during the winter) during the definitive prebasic molt period when adult swans replace remiges, and are therefore flightless, using a combination of jon boats, airboats, step deck transom boats, square-stern canoes, and kayaks.
We primarily used long-tail mud motors (Powell Performance Fab, Hutchinson, Minnesota, USA) to navigate shallow wetlands where swans were located although some swans were captured using surface-drive motors (Gator-Tail, Loreauville, Louisiana, USA).
We hand-captured swans using a shepherd's crook pole [@eltringham1978; @hindman2016].
We predominantly targeted adult swans, which have higher survival rates than juveniles, to maximize the longevity of telemetry data collection [@lockman1990].

We marked swans with two types of neck collars; 55-g neck collars with GPS-GSM transmitters incorporated into the collar housing (Model OrniTrack-N62 3G, Ornitela, Vilnius, Lithuania) and 140-g GPS transmitters (Model CTT-ES400, Cellular Tracking Technologies, [CTT], Rio Grande, New Jersey, USA) that were adhered to 64-mm neck collars (Haggie Engraving, Crumpton, Maryland, USA).
Both types of neck collars contained a unique alpha-numeric code for visual identification.
Swans captured in Michigan were fit with CTT collars and all other swans in the study were fit with Ornitela collars.
All transmitters were programmed to collect GPS locations at 15-min intervals throughout the 24-hr daily period.
We leg-banded each swan with a U.S.
Geological Survey butt-end aluminum band.

Protocols for capturing and marking trumpeter swans in U.S. states were approved by the University of Minnesota Animal Care and Use Committee (protocol no. 1905-37072A), the Minnesota Department of Natural Resources (Special Permit no. 19017), the Michigan Department of Natural Resources (Threatened and Endangered Species Permit TE 175), the U.S.
Fish and Wildlife Service (Research & Monitoring Special Use Permit no. K-10-001), and the U.S.
Geological Survey Bird Banding Laboratory (Federal Bird Banding Permit no. 21631).
All capture and marking of trumpeter swans in Manitoba was conducted under Federal Scientific Permit to Capture and Band Migratory Birds (no. 10271), Federal Animal Care Committee approval (project 20FB02), Provincial Species at Risk Permit (no. SAR20012), and Provincial Park Permit (no. PP-PHQ-20-016).**Need permit info from WI, IA, AR, and OH?**

### Migration Phenology Classification

To quantify migration phenology throughout the annual cycle, we first calculated yearly time-series of Net-Squared Displacement (NSD) values for each swan, using July 1 as a cutoff date between years for individuals with multiple years of GPS data, and then condensed the dataset to a single average NSD value per day.
After excluding swan-year datasets with less than 30 days of data, we iteratively fit a series of 7 intercept-only piecewise regression models to each time-series [@wolfson2022].
The syntax of each model corresponded to an increasing number of intercepts included (1-7) for average NSD values throughout the time series separated by breakpoints in time where the intercept values transitioned, therefore intercepts represent stationary segments in time corresponding to periods of the annual cycle, and breakpoints are the transitions between these segments.
We fit all piecewise regression models in JAGS [@plummer2003] using the mcp package [@lindelov2020] in Program R version 4.0.2 [@rcoredevelopmentteam2022], using 15,000 iterations and a burn-in period of 10,000.
We ran all scripts in parallel using the future package on a partition of the Minnesota Supercomputing Institute (MSI) with 48 cores and 50GB RAM per core [@bengtsson2021].
We evaluated MCMC chain convergence via the Gelman-Rubin convergence diagnostic and excluded any model containing a parameter with a value of $\hat{R}$ \>1.1 from further analyses [@brooks1998].
If all parameters in a model passed the $\hat{R}$ threshold, we evaluated model fit and predictive performance using leave-one-out cross-validation (LOO-CV) with Pareto smoothed importance sampling to estimate the Expected Log Predictive Density (ELPD), using the loo package [@gelman2014; @vehtari2017].
The ELPD values reflect the ability of the model to predict the posterior density of withheld data.
We used LOO-CV to choose the ideal number of breakpoints (and thereby segments that correspond to migratory periods) for each swan-year dataset by selecting the model with the best ELPD value.

We qualitatively inspected the visual fit of each model chosen by ELPD for each swan-year dataset and removed 11 (out of 241 total datasets) that were obvious poor fits such that information from the breakpoints and intercepts would not be able to describe the annual migration phenology (link to Supplemental Materials).
For models that passed visual inspection (230 out of 241), we extracted parameter values to represent the movement metrics of interest **(reference all of these metrics in a table?)** after first applying a series of criteria thresholds to strengthen the biological connection of the breakpoints and intercept values from the fitted models.
**(include these in the supplemental as well?)**.

### Summary of Migratory Trends

We devised a flexible workflow that could accommodate a wide breadth of variability in annual movements (because we're fitting to individual years of data from each swan instead of a bigger pooled dataset) but still allow for population-level inference.
For all swan-year datasets that had \>30 points and had the best-fitting model pass visual inspection for **biological relevance**, we derived a number of movement metrics to describe annual movement trends by creating an algorithm to exclude erroneous segments and changepoints that didn't represent biologically meaningful transitions between different segments of the annual movement cycle.
(link to Supp Materials for rulesets)


### Latent State Model for Migration Extent

We modeled the relationship between breeding latitude and migration extent (defined as max displacement from breeding territory throughout the non-breeding season) using a state-space formulation for assignment in one of two migration 'strategy' categories, either a linear relationship between breeding latitude or a quadratic relationship in which swans at lower latitudes do not travel long distances but make greater movements at higher latitudes. The underlying latent migration strategy for each 'swan-year' dataset was modeled as:


$$z_i\sim Bernoulli(\pi)$$
with a hyperprior for $\pi$:
$$\pi\sim Uniform(0,1)$$
The model likelihood was as follows:

$$Y_i\sim\mathcal{N}(\mu_i, z_i\cdot\tau_1+(1-z_i\cdot\tau_2)$$

$$\mu_i=z_i*(\alpha+\beta\cdot x_i)+(1-z_i)*(c+\gamma\cdot x_i^\delta)$$
where $z_i$ is the latent state (1 or 0) for assignment to a migration strategy, $Y_i$ is the extent of migration for individual $i$, $\tau_1$ and $\tau_2$ are the independent variance components for each latent state, $\alpha$ and $\beta$ are the intercept and slope for the linear model, $x_i$ is the breeding latitude for individual $i$, $c$ and $\gamma$ are the intercept and slope of the non-linear model, and $\delta$ is the exponent of breeding latitude in the non-linear model. We implemented the model in JAGS via the rjags R package using 3 MCMC chains with 200,000 iterations, a burn-in of 20,000, and a thinning rate of 10 [@plummer2003; @su2021b].

### Variability in Annual Movements

We estimated the consistency of migration phenology by calculating among-individual variation, within-individual variation, and repeatability (defined as the proportion of the total variance accounted for by differences among groups) of fall departure dates, spring arrival dates, and migration duration using a linear mixed model (LMM) approach with restricted maximum likelihood, which is robust to unbalanced designs and account for repeated measures [@nakagawa2010].  

For each of three migration phenology response terms, we fit separate models in which $y_{ij}$ are the observations of the migration metric (e.g. spring arrival date) for the $i$th individual ($i=1,...,k$) on the $j$th year, $\beta_0$ is the overall population mean, $\gamma_{ij}$ is a vector of covariates for individual $i$ and year $j$ (breeding status and sex) that control for confounding effects that will otherwise inflate the total phenotypic variance, $\alpha_i$ is a random effect for individuals (assumed to be normally distributed with a mean of 0 and variance $\sigma_{\alpha}^2$), and $\epsilon_{ij}$ is a random error term (assumed to be normally distributed with mean of 0 and variance of $\sigma_{\alpha}^2$):

$$y_{ij}=\beta_0+\gamma_{ij}+\alpha_i+\epsilon_{ij}$$
$$\alpha\sim \mathcal{N}(0,\sigma_{\alpha}^2)$$
$$\epsilon_{ij}\sim \mathcal{N}(0,\sigma_{\epsilon}^2)$$

 
The variance of random effects, $\sigma_{\alpha}^2$, specified as individual swan ID, is the within-individual variation, the variance remaining in model residuals, $\sigma_{\epsilon}^2$, represents among-individual variation; and repeatability, $R_M$, is defined as the proportion of total phenotypic variance in the population, $\sigma_{p}^2$, that is due to among-individual variation.

$$R_M=\frac{\sigma_{\alpha}^2}{\sigma_{\alpha}^2+\sigma_{\epsilon}^2}$$

$$\sigma_{p}^2=\sigma_{\alpha}^2+\sigma_{\epsilon}^2$$

We fit LMMs with restricted maximum likelihood estimation using the lme4 R package and conducted parametric bootstrapping with 1000 iterations to quantify the uncertainty in adjusted repeatability estimates using the rptR R package [@bates2015; @stoffel2017]. 

**Include a supplemental file that shows the thresholds for each rule in the script that pulls out the movement summary information. In the main text, briefly allude to the ruleset without laying everything out in a lot of detail?**

## Results

### Capture/deployment/data stuff

We deployed 113 collars with GPS-GSM transmitters on 126 trumpeter swans (including 13 redeployments using collars recovered from mortalities).
Of these, 78 were female and 48 were male; 73 were breeding adults (cygnets present), 22 were adults with mates present but not cygnets at time of capture, 24 were non-breeding adults captured while in large groups, and 6 were cygnets at the time of capture.

```{=html}
<!-- **Potentially cut out this paragraph or stick in an appendix/supplemental** In 2019, we deployed 19 transmitters (7 in Minnesota and 12 in Michigan).
In 2020, we deployed an additional 78 transmitters (10 in Manitoba, 40 in Minnesota, 9 in Iowa, 5 in Wisconsin, 2 in Michigan, 12 in Ohio).
In 2021, we deployed an additional 28 transmitters, 11 of which were re-deployments (1 in Manitoba, 9 in Minnesota, 2 in Iowa, 4 in Wisconsin, 8 in Ohio, and 4 in Arkansas).
In 2022 we redeployed 1 transmitter in Iowa. -->
```
We collected 252 unique 'swan-year' telemetry datasets. We excluded 19 datasets due to insufficient temporal data coverage and 11 datasets due to a lack of piecewise regression model convergence.

```{=html}
<!-- We excluded 11 datasets because they had less than 30 days of locations, and therefore were insufficient to estimate movement trends, and fit mcp models to the remaining 241 swan-year datasets.

After visually inspecting the fitted piecewise regression models, we excluded an additional 11 swan-year datasets that didn't have a good model fit, bringing the number to 230.

We excluded 6 swan-year datasets that had large dispersal events during the summer, likely representing from non-breeders or failed breeders, and therefore didn't conform to the methodology we used to extract info from fitted piecewise regression models. -->
```
### Main text of results

```{=html}
<!-- # Names of figures: 
     - deployment-fig 
     - mig-extent-vs-latitude-fig 
     - timing-vs-latitude-fig 
     - timing-vs-breeding-fig 
     - duration-fig 
     - latent-state-fig
-->
```
```{=html}
<!-- # Names of tables:
     - one-liner of long-distance fall departures: combined-fall-table
     - one-liner of spring arrivals: combined-spring-table
     - fall departures by year: fall-yearly-table
     - spring arrivals by year: spring-yearly-table
     - fall by breeding status: fall-breeding-table
     - spring by breeding status: spring-breeding-table
-->
```
<!-- # Figure citation (Fig. @ref(fig:timing-vs-breeding-fig)) -->

<!-- # Table citation (Table @ref(tab:table-name)) -->

Proportion of IP that is migratory, and the extent of migratory distance:\
Annual movements of IP trumpeter swans were highly variable.
For swans that underwent long-distance migration (**add in x out of x went \>xx km?**), there was a strong correlation between breeding/capture latitude (mostly between 43 and 53 degrees latitude) and the extent of migration during the non-breeding season (Fig. \@ref(fig:mig-extent-vs-latitude-fig)).
However, many swans with breeding/capture sites between 40 and 48 degrees latitude showed minimal movement during the non-breeding season and can be considered resident or exhibiting short-distance regional movements.

Migration phenology, relationships to breeding and latitude, and variability:\
Dates of departure from breeding territories in the fall by long-distance migrants (\>100km) were variable, with the overall average departure date across years on November 1st with a standard deviation of 20 days (Table \@ref(tab:combined-fall-table)), and yearly averages ranged from October 26 to November 7 (Table \@ref(tab:fall-yearly-table)).
We found little to no evidence of a relationship between breeding latitude and date of fall departure (Fig. \@ref(fig:timing-vs-latitude-fig)), but breeders and cygnets left later, on average, than non-breeders or paired swans, and non-breeders had much higher variability in timing than the other breeding categories (s.d.=30 for non-breeders and s.d.=10 for each other category) (Fig. \@ref(fig:timing-vs-breeding-fig), Table \@ref(tab:fall-breeding-table)).

Variation and repeatability:



<!-- Swans arriving back on their territory in the spring had relatively low levels of individual variability within years, and arrival dates correlated highly with their breeding/capture latitude. -->
<!-- There was also a much greater difference between breeding classes, with successful breeders arriving much earlier on average than non-breeders or paired swans. -->
<!-- The level of individual variability between years was xxxxx. -->

```{r deployment-fig, fig.align="left", fig.cap="Insert caption for data deployment figure here..."}

# all code needed to create this plot is present at    here("scripts/scripts_for_manuscript_figures/deployment.R")


knitr::include_graphics(here("figures/figs_for_manuscript/deployments.tiff"))
```

**Include some/all of the figures for the most important summaries of annual movement. And also include a reference to the full table of all parameter output.**

1)  the proportion of IP that is migratory and the extent of those movements

```{r mig-extent-vs-latitude-fig, fig.align="left", fig.cap="Insert caption for breedng lat vs mig extent figure here..."}
# third round (post apr/may 2023)
param_df<-read_csv(here("output/migration_metrics_3rd.csv"))

# Merge additional info onto dataframe
ids<-read_csv(here("ids.csv"))
param_df<-param_df %>% 
  left_join(., ids,
            by=c("swan_ID" = "id")) %>% 
  select(-mate_present, -'mass (kg)', -'skull (mm)',-'tarsus (mm)', -comments) %>% 
  rename(breeding_status="breeding_status(if cygnets=breeder; if mate=paired;else non-breeder or cygnet)",
         id_year=year)


# Translate back to dates from julian day
p_dates<-param_df %>% 
  mutate(across(c(fall_mig_onset, 
                  first_departure,
                  furthest_seg_arrival, 
                  furthest_seg_departure, 
                  spring_arrival),
                ~ifelse(.<186, .+181, .-185)))


p_dates<-p_dates %>% 
  mutate(across(c(fall_mig_onset, 
                  first_departure,
                  furthest_seg_arrival, 
                  furthest_seg_departure, 
                  spring_arrival),
                ~as.Date(., origin="2019-12-31")))

# Add specific years for the fall and spring events (fall_onset and spring_arrival) to track yearly variation
p_dates<-p_dates %>% 
  mutate(fall_yr=map_chr(strsplit(.$id_year, "-"), ~.x[2]),
         spring_yr=map_chr(strsplit(.$id_year, "-"), ~.x[3]))

# add column for entire year cycle
p_dates<-p_dates %>% 
  mutate(entire_yr=paste(map_chr(strsplit(.$id_year, "-"), ~.x[2]),
                         map_chr(strsplit(.$id_year, "-"), ~.x[3]), sep="-"))

p_dates<-p_dates %>% 
  mutate(capture_state=ifelse(grepl("[7-9]L", swan_ID)|
                                grepl("0H_2nd", swan_ID), "AR",
                              ifelse(grepl("9H_2nd", swan_ID)|
                                       grepl("2H_2nd", swan_ID)|
                                       grepl("0N_2nd", swan_ID)|
                                       grepl("6P", swan_ID), "MN",
                                     ifelse(grepl("A", swan_ID)|
                                              grepl("E", swan_ID)|
                                              grepl("R", swan_ID)|
                                              grepl("T",swan_ID)|
                                              grepl("L", swan_ID),"MN",
                                            ifelse(grepl("M", swan_ID)|
                                                     grepl("N", swan_ID), "OH",
                                                   ifelse(grepl("H", swan_ID), "MB",
                                                          ifelse(grepl("C", swan_ID), "IA",
                                                                 ifelse(grepl("P", swan_ID), "WI",
                                                                        ifelse(grepl("J", swan_ID)|
                                                                                 grepl("K", swan_ID), "MI",
                                                                               "flag")))))))))

# Filter out swans that:
# - had incomplete years  (6/7 of 1st yr MN collars)
# I'll consider a swan-year incomplete if it doesn't make it through Jan (unless there is already a settled winter plateau)
incomplete<-c("OC_2nd-2022-2023",
              "0H-2021-2022" ,
              "1P-2020-2021", 
              "3N-2021-2022",
              "4H-2021-2022", 
              "5E-2021-2022",
              "7P-2022-2023",
              "9J (first deployment)-2019-2020",
              "9J (swan originally collared as 5J)-2021-2022")

# - made big summer dispersal movements  n=5? (5L, 6M, 9N, 4P, 8P, 7M)
# 4P did make big movements during the summer, but they were equivalent in distance to it's winter movements, so retain
# Dropped 7M because it made a big movement NE into Pennsylvania (and then back to territory)
dispersers<-c("6M-2021-2022", "6M-2022-2023",
              "5L-2020-2021" ,"5L-2021-2022",
              "7M-2021-2022", 
              "8P-2021-2022", 
              "9N-2021-2022", "9N-2022-2023")

filt_vec<-c(incomplete, dispersers)


p_dates<-p_dates %>% 
  filter(!id_year%in%filt_vec)

dist_plot<-p_dates %>% 
    filter(fall_yr!=2019) %>% 
  ggplot(aes(breeding_lat,mig_extent))+
  geom_point()+
  # geom_hline(yintercept = quantile(p_dates$mig_extent, 0.5, na.rm=T), 
  #            lty=2, color="red")+
  # geom_text(aes(52, quantile(p_dates$mig_extent, 0.5, na.rm=T),
  #               label="50% quantile", vjust=-1), size=5, color="red")+
  # geom_hline(yintercept = quantile(p_dates$mig_extent, 0.25, na.rm=T), 
  #            lty=2, color="blue")+
  #  geom_text(aes(52, quantile(p_dates$mig_extent, 0.25, na.rm=T),
  #               label="25% quantile", vjust=-1), size=5, color="blue")+
  # geom_hline(yintercept = quantile(p_dates$mig_extent, 0.75, na.rm=T), 
  #            lty=2, color="darkgreen")+
  #  geom_text(aes(52, quantile(p_dates$mig_extent, 0.75, na.rm=T),
  #               label="75% quantile", vjust=-1), size=5, color="darkgreen")+
  labs(x="\nBreeding/Capture Latitude",
       y="Furthest Extent of Migration (in km)\n")+
  theme_pubr()

 # dist_plot
 # 
 # ggsave(here("figures/figs_for_manuscript/distances_latitude.tiff"),
 # dpi=300, compression="lzw")

knitr::include_graphics(here("figures/figs_for_manuscript/distances_latitude.tiff"))
```


```{r latent-state-fig, fig.align="left", fig.cap="Insert caption for latent state model figure here..."}

knitr::include_graphics(here("figures/figs_for_manuscript/latent_state.png"))
```




, 2) migration phenology, 3) the role of breeding status and breeding location on annual movement patterns

```{r timing-vs-latitude-fig, fig.align="left", fig.cap="Insert caption for timing vs latitude status figure here..."}
# third round (post apr/may 2023)
param_df<-read_csv(here("output/migration_metrics_3rd.csv"))

# Merge additional info onto dataframe
ids<-read_csv(here("ids.csv"))
param_df<-param_df %>% 
  left_join(., ids,
            by=c("swan_ID" = "id")) %>% 
  select(-mate_present, -'mass (kg)', -'skull (mm)',-'tarsus (mm)', -comments) %>% 
  rename(breeding_status="breeding_status(if cygnets=breeder; if mate=paired;else non-breeder or cygnet)",
         id_year=year)


# Translate back to dates from julian day
p_dates<-param_df %>% 
  mutate(across(c(fall_mig_onset, 
                  first_departure,
                  furthest_seg_arrival, 
                  furthest_seg_departure, 
                  spring_arrival),
                ~ifelse(.<186, .+181, .-185)))


p_dates<-p_dates %>% 
  mutate(across(c(fall_mig_onset, 
                  first_departure,
                  furthest_seg_arrival, 
                  furthest_seg_departure, 
                  spring_arrival),
                ~as.Date(., origin="2019-12-31")))

# Add specific years for the fall and spring events (fall_onset and spring_arrival) to track yearly variation
p_dates<-p_dates %>% 
  mutate(fall_yr=map_chr(strsplit(.$id_year, "-"), ~.x[2]),
         spring_yr=map_chr(strsplit(.$id_year, "-"), ~.x[3]))

# add column for entire year cycle
p_dates<-p_dates %>% 
  mutate(entire_yr=paste(map_chr(strsplit(.$id_year, "-"), ~.x[2]),
                         map_chr(strsplit(.$id_year, "-"), ~.x[3]), sep="-"))


p1<-p_dates %>% 
  filter(!is.na(breeding_status)) %>% 
  filter(fall_yr!=2019) %>% 
  ggplot(aes(breeding_lat,fall_mig_onset, color=fall_yr))+
  geom_point(aes(color=fall_yr), size=2)+
  geom_point(shape=1, color="black", size=2)+
  # geom_rug(aes(y=NULL))+
  geom_smooth(method="lm", alpha=0.25)+
  stat_cor(aes(label = paste(after_stat(rr.label))), # adds R^2 value
           r.accuracy = 0.01,
           size = 4,
           label.x=45, label.y=as.Date("2020-12-15"))+
  facet_wrap(~fall_yr)+
    labs(y="Date of Fall Departure\n", x="")+
  scale_x_continuous(n.breaks=4)+
  guides(color=F)+
  theme_pubr()

# For a marginal plot on the side using patchwork
# dens1<-p_dates %>%
#     filter(!is.na(breeding_status)) %>%
#     filter(fall_yr!=2019) %>%
#   ggplot(aes(x=fall_mig_onset, fill=fall_yr))+
#   geom_density(alpha=0.4)+
#   coord_flip()+
#   theme_void()
# 
# library(patchwork)
# p1+dens1+
#   plot_layout(
#     ncol=2,
#     nrow=1
#   )

# the spring arrival vs latitude
p2<-p_dates %>% 
  filter(!is.na(breeding_status)) %>% 
  filter(fall_yr!=2019) %>% 
  ggplot(aes(breeding_lat,spring_arrival,color=spring_yr))+
  geom_point(aes(color=spring_yr), size=2)+
  geom_point(shape=1, color="black", size=2)+
  # geom_rug(aes(y=NULL))+
  geom_smooth(method="lm", alpha=0.3)+
  stat_cor(aes(label = paste(after_stat(rr.label))), # adds R^2 value
           r.accuracy = 0.01,
           size = 4,
           label.x=45, label.y=as.Date("2020-04-20"))+
  facet_wrap(~spring_yr)+
    scale_x_continuous(n.breaks=4)+
  labs(x="\nBreeding/Capture Latitude", 
       y="Date of Spring Arrival\n")+
  guides(color=F)+
  theme_pubr()

# timings<-p1+p2+
#   plot_layout(
#     ncol=1
#   )
# timings
# 
# ggsave(here("figures/figs_for_manuscript/timings_latitude.tiff"),
#  dpi=300, compression="lzw")
knitr::include_graphics(here("figures/figs_for_manuscript/timings_latitude.tiff"))
```

```{r timing-vs-breeding-fig, fig.align="left", fig.cap="Insert caption for timing vs breeding status figure here..."}
# third round (post apr/may 2023)
param_df<-read_csv(here("output/migration_metrics_3rd.csv"))

# Merge additional info onto dataframe
ids<-read_csv(here("ids.csv"))
param_df<-param_df %>% 
  left_join(., ids,
            by=c("swan_ID" = "id")) %>% 
  select(-mate_present, -'mass (kg)', -'skull (mm)',-'tarsus (mm)', -comments) %>% 
  rename(breeding_status="breeding_status(if cygnets=breeder; if mate=paired;else non-breeder or cygnet)",
         id_year=year)


# Translate back to dates from julian day
p_dates<-param_df %>% 
  mutate(across(c(fall_mig_onset, 
                  first_departure,
                  furthest_seg_arrival, 
                  furthest_seg_departure, 
                  spring_arrival),
                ~ifelse(.<186, .+181, .-185)))

# remove a swan with only partial info
p_dates<-p_dates %>% 
  filter(!id_year%in%"8P-2021-2022")

p_dates<-p_dates %>% 
  mutate(across(c(fall_mig_onset, 
                  first_departure,
                  furthest_seg_arrival, 
                  furthest_seg_departure, 
                  spring_arrival),
                ~as.Date(., origin="2019-12-31")))

# Add specific years for the fall and spring events (fall_onset and spring_arrival) to track yearly variation
p_dates<-p_dates %>% 
  mutate(fall_yr=map_chr(strsplit(.$id_year, "-"), ~.x[2]),
         spring_yr=map_chr(strsplit(.$id_year, "-"), ~.x[3]))

# add column for entire year cycle
p_dates<-p_dates %>% 
  mutate(entire_yr=paste(map_chr(strsplit(.$id_year, "-"), ~.x[2]),
                         map_chr(strsplit(.$id_year, "-"), ~.x[3]), sep="-"))

# plot for timing of migration vs breeder/non-breeder/paired
fall_onset<-p_dates %>% 
  filter(breeding_status%in%c("breeder", "non_breeder", "paired")) %>% 
  mutate(breeding_status=fct_relevel(breeding_status, "breeder", "paired", "non_breeder")) %>% 
  ggplot(., aes(breeding_status, fall_mig_onset,fill=breeding_status))+
    scale_x_discrete(labels=c("Breeder", "Paired", "Non Breeder"))+
  geom_boxplot(outlier.shape = NA)+
  scale_y_date(date_labels = "%b %d")+
  geom_jitter(width = 0.1)+
  scale_fill_manual(values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  ggtitle(label="Fall Onset")+
  theme(plot.title = element_text(hjust=0.5, size=14),
        plot.subtitle = element_text(hjust=0.5, size=12))+
  labs(x="\nBreeding Status", y="Date of Fall Migration Onset\n")+
  theme_pubr()+
  theme(legend.position = "none", plot.title = element_text(hjust=0.5))

spring_arrival<-p_dates %>% 
  filter(breeding_status%in%c("breeder", "non_breeder", "paired")) %>% 
  mutate(breeding_status=fct_relevel(breeding_status, "breeder", "paired", "non_breeder")) %>% 
  ggplot(., aes(breeding_status, spring_arrival,fill=breeding_status))+
      scale_x_discrete(labels=c("Breeder", "Paired", "Non Breeder"))+
  geom_boxplot(outlier.shape = NA)+
    scale_y_date(date_labels = "%b %d")+
  geom_jitter(width = 0.1)+
  scale_fill_manual(values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  ggtitle(label="Spring Arrival")+
  theme(plot.title = element_text(hjust=0.5, size=14),
        plot.subtitle = element_text(hjust=0.5, size=12))+
  labs(x="\nBreeding Status", y="Date of Spring Arrival\n")+
    theme_pubr()+
  theme(legend.position = "none", plot.title = element_text(hjust=0.5))

# fall_onset+spring_arrival

# breeding_timing<-fall_onset+spring_arrival
#   plot_layout(
#     ncol=1
#   )
# ggsave(here("figures/figs_for_manuscript/breeding_timing.tiff"),
#             dpi=300, compression="lzw")

knitr::include_graphics(here("figures/figs_for_manuscript/breeding_timing.tiff"))
```

```{r duration-fig, fig.align="left", fig.cap="Insert caption for duration vs breeding status figure here..."}
# third round (post apr/may 2023)
param_df<-read_csv(here("output/migration_metrics_3rd.csv"))

# Merge additional info onto dataframe
ids<-read_csv(here("ids.csv"))
param_df<-param_df %>% 
  left_join(., ids,
            by=c("swan_ID" = "id")) %>% 
  select(-mate_present, -'mass (kg)', -'skull (mm)',-'tarsus (mm)', -comments) %>% 
  rename(breeding_status="breeding_status(if cygnets=breeder; if mate=paired;else non-breeder or cygnet)",
         id_year=year)


# Translate back to dates from julian day
p_dates<-param_df %>% 
  mutate(across(c(fall_mig_onset, 
                  first_departure,
                  furthest_seg_arrival, 
                  furthest_seg_departure, 
                  spring_arrival),
                ~ifelse(.<186, .+181, .-185)))


p_dates<-p_dates %>% 
  mutate(across(c(fall_mig_onset, 
                  first_departure,
                  furthest_seg_arrival, 
                  furthest_seg_departure, 
                  spring_arrival),
                ~as.Date(., origin="2019-12-31")))

# Add specific years for the fall and spring events (fall_onset and spring_arrival) to track yearly variation
p_dates<-p_dates %>% 
  mutate(fall_yr=map_chr(strsplit(.$id_year, "-"), ~.x[2]),
         spring_yr=map_chr(strsplit(.$id_year, "-"), ~.x[3]))

# add column for entire year cycle
p_dates<-p_dates %>% 
  mutate(entire_yr=paste(map_chr(strsplit(.$id_year, "-"), ~.x[2]),
                         map_chr(strsplit(.$id_year, "-"), ~.x[3]), sep="-"))

# plot for duration of migration vs breeder/non-breeder/paired

breeding_duration<-p_dates %>% 
  filter(breeding_status%in%c("breeder", "non_breeder", "paired")) %>% 
  mutate(breeding_status=fct_relevel(breeding_status, "breeder", "paired", "non_breeder")) %>% 
  ggplot(., aes(breeding_status, mig_duration,fill=breeding_status))+
  scale_x_discrete(labels=c("Breeder", "Paired", "Non Breeder"))+
  geom_boxplot(outlier.shape = NA)+
  geom_jitter(width = 0.1)+
  scale_fill_manual(values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  ggtitle(label="Migration Duration vs Breeding Status")+
  theme(plot.title = element_text(hjust=0.5, size=14),
        plot.subtitle = element_text(hjust=0.5, size=12))+
  labs(x="\nBreeding Status", y="Migration Duration (# of days)\n")+
    theme_pubr()+
  theme(legend.position = "none", plot.title = element_text(hjust=0.5))

migration_latitude<-p_dates %>% 
  filter(breeding_status%in%c("breeder", "non_breeder", "paired")) %>% 
  mutate(breeding_status=fct_relevel(breeding_status, "breeder", "paired", "non_breeder")) %>% 
  ggplot(., aes(breeding_lat, mig_duration))+
  geom_point()+
  geom_smooth(method="lm", alpha=0.3)+
  stat_cor(aes(label = paste(after_stat(rr.label))), # adds R^2 value
           r.accuracy = 0.01,
           size = 4)+
  ggtitle(label="Migration Duration vs Breeding Latitude")+
  theme(plot.title = element_text(hjust=0.5, size=14),
        plot.subtitle = element_text(hjust=0.5, size=12))+
  labs(x="\nBreeding Latitude", y="Migration Duration (# of days)\n")+
    theme_pubr()+
  theme(legend.position = "none", plot.title = element_text(hjust=0.5))


# durations<-breeding_duration+migration_latitude+
#   plot_layout(
#     nrow=1
#   )
# 
# ggsave(here("figures/figs_for_manuscript/durations.tiff"),
#             dpi=300, compression="lzw")

knitr::include_graphics(here("figures/figs_for_manuscript/durations.tiff"))


```

4)  the degree of individual and population variability in migration patterns

### Summary tables of migration phenology

```{r combined-fall-table}
# third round (post apr/may 2023)
param_df<-read_csv(here("output/migration_metrics_3rd.csv"))

# Merge additional info onto dataframe
ids<-read_csv(here("ids.csv"))
param_df<-param_df %>% 
  left_join(., ids,
            by=c("swan_ID" = "id")) %>% 
  select(-mate_present, -'mass (kg)', -'skull (mm)',-'tarsus (mm)', -comments) %>% 
  rename(breeding_status="breeding_status(if cygnets=breeder; if mate=paired;else non-breeder or cygnet)",
         id_year=year)


# Translate back to dates from julian day
p_dates<-param_df %>% 
  mutate(across(c(fall_mig_onset, 
                  first_departure,
                  furthest_seg_arrival, 
                  furthest_seg_departure, 
                  spring_arrival),
                ~ifelse(.<186, .+181, .-185)))


p_dates<-p_dates %>% 
  mutate(across(c(fall_mig_onset, 
                  first_departure,
                  furthest_seg_arrival, 
                  furthest_seg_departure, 
                  spring_arrival),
                ~as.Date(., origin="2019-12-31")))

# Add specific years for the fall and spring events (fall_onset and spring_arrival) to track yearly variation
p_dates<-p_dates %>% 
  mutate(fall_yr=map_chr(strsplit(.$id_year, "-"), ~.x[2]),
         spring_yr=map_chr(strsplit(.$id_year, "-"), ~.x[3]))

# add column for entire year cycle
p_dates<-p_dates %>% 
  mutate(entire_yr=paste(map_chr(strsplit(.$id_year, "-"), ~.x[2]),
                         map_chr(strsplit(.$id_year, "-"), ~.x[3]), sep="-"))


# first, show a table with summary stats for fall departure and spring arrival
# all swans and years, fall departures
fall_table<-p_dates %>% 
  drop_na(fall_mig_onset) %>% 
  summarize(num_swans=length(unique(swan_ID)),
            num_swan_years=n(),
            average_fall_depart=format(mean(as.POSIXct(fall_mig_onset)), "%B %d"),
            # median_fall_depart=format(median(as.POSIXct(fall_mig_onset)), "%B %d"),
            stan_dev_fall_depart=signif(sd(fall_mig_onset), digits =0),
            earliest_fall_depart=format(range(fall_mig_onset)[1], "%B %d"),
            latest_fall_depart=format(range(fall_mig_onset)[2], "%B %d"))



fall_table %>% 
  flextable() %>% 
  set_header_labels(values=list(
    "num_swans" = "Number of Swans",
    "num_swan_years" = "Number of Swan-Years",
    "average_fall_depart" = "Average Fall Departure",
    "stan_dev_fall_depart" = "Standard Deviation (in days)",
    "earliest_fall_depart" = "Earliest Departure",
    "latest_fall_depart" = "Latest Departure")) %>% 
  set_table_properties(layout="autofit") %>% 
  vline(part="header") %>% 
  align(align ='center', part = 'all') %>% 
  bg(part="header", bg="#dbdbdb") %>% 
  bold(part="header") %>% 
  set_caption("Migration phenology of fall departures by long-distance migrants")
```

```{r combined-spring-table}
# third round (post apr/may 2023)
param_df<-read_csv(here("output/migration_metrics_3rd.csv"))

# Merge additional info onto dataframe
ids<-read_csv(here("ids.csv"))
param_df<-param_df %>% 
  left_join(., ids,
            by=c("swan_ID" = "id")) %>% 
  select(-mate_present, -'mass (kg)', -'skull (mm)',-'tarsus (mm)', -comments) %>% 
  rename(breeding_status="breeding_status(if cygnets=breeder; if mate=paired;else non-breeder or cygnet)",
         id_year=year)


# Translate back to dates from julian day
p_dates<-param_df %>% 
  mutate(across(c(fall_mig_onset, 
                  first_departure,
                  furthest_seg_arrival, 
                  furthest_seg_departure, 
                  spring_arrival),
                ~ifelse(.<186, .+181, .-185)))


p_dates<-p_dates %>% 
  mutate(across(c(fall_mig_onset, 
                  first_departure,
                  furthest_seg_arrival, 
                  furthest_seg_departure, 
                  spring_arrival),
                ~as.Date(., origin="2019-12-31")))

# Add specific years for the fall and spring events (fall_onset and spring_arrival) to track yearly variation
p_dates<-p_dates %>% 
  mutate(fall_yr=map_chr(strsplit(.$id_year, "-"), ~.x[2]),
         spring_yr=map_chr(strsplit(.$id_year, "-"), ~.x[3]))

# add column for entire year cycle
p_dates<-p_dates %>% 
  mutate(entire_yr=paste(map_chr(strsplit(.$id_year, "-"), ~.x[2]),
                         map_chr(strsplit(.$id_year, "-"), ~.x[3]), sep="-"))


# all swans and years, spring arrivals
spring_table<-p_dates %>% 
  drop_na(spring_arrival) %>% 
  summarize(num_swans=length(unique(swan_ID)),
            num_swan_years=n(),
            average_spring_arrival=format(mean(as.POSIXct(spring_arrival)), "%B %d"),
            # median_spring_arrival=format(median(as.POSIXct(spring_arrival)), "%B %d"),
            stan_dev_spring_arrival=signif(sd(spring_arrival), digits=0),
            earliest_spring_arrival=format(range(spring_arrival)[1], "%B %d"),
            latest_spring_arrival=format(range(spring_arrival)[2], "%B %d"))

spring_table %>% 
  flextable() %>% 
  set_header_labels(values=list(
    "num_swans" = "Number of Swans",
    "num_swan_years" = "Number of Swan-Years",
    "average_spring_arrival" = "Average Spring Arrival",
    "stan_dev_spring_arrival" = "Standard Deviation (in days)",
    "earliest_spring_arrival" = "Earliest Arrival",
    "latest_spring_arrival" = "Latest Arrival")) %>% 
  set_table_properties(layout="autofit") %>% 
  vline(part="header") %>% 
  align(align ='center', part = 'all') %>% 
  bg(part="header", bg="#dbdbdb") %>% 
  bold(part="header") %>% 
  set_caption("Migration phenology of spring arrivals by long-distance migrants")
```

```{r fall-yearly-table}
# third round (post apr/may 2023)
param_df<-read_csv(here("output/migration_metrics_3rd.csv"))

# Merge additional info onto dataframe
ids<-read_csv(here("ids.csv"))
param_df<-param_df %>% 
  left_join(., ids,
            by=c("swan_ID" = "id")) %>% 
  select(-mate_present, -'mass (kg)', -'skull (mm)',-'tarsus (mm)', -comments) %>% 
  rename(breeding_status="breeding_status(if cygnets=breeder; if mate=paired;else non-breeder or cygnet)",
         id_year=year)


# Translate back to dates from julian day
p_dates<-param_df %>% 
  mutate(across(c(fall_mig_onset, 
                  first_departure,
                  furthest_seg_arrival, 
                  furthest_seg_departure, 
                  spring_arrival),
                ~ifelse(.<186, .+181, .-185)))


p_dates<-p_dates %>% 
  mutate(across(c(fall_mig_onset, 
                  first_departure,
                  furthest_seg_arrival, 
                  furthest_seg_departure, 
                  spring_arrival),
                ~as.Date(., origin="2019-12-31")))

# Add specific years for the fall and spring events (fall_onset and spring_arrival) to track yearly variation
p_dates<-p_dates %>% 
  mutate(fall_yr=map_chr(strsplit(.$id_year, "-"), ~.x[2]),
         spring_yr=map_chr(strsplit(.$id_year, "-"), ~.x[3]))

# add column for entire year cycle
p_dates<-p_dates %>% 
  mutate(entire_yr=paste(map_chr(strsplit(.$id_year, "-"), ~.x[2]),
                         map_chr(strsplit(.$id_year, "-"), ~.x[3]), sep="-"))

# Split out by year
fall_yearly<-p_dates %>% 
  drop_na(fall_mig_onset) %>% 
  # filter(!fall_yr==2019) %>% 
  group_by(fall_yr) %>% 
  summarize(num_swans=length(unique(swan_ID)),
            average_fall_depart=format(mean(as.POSIXct(fall_mig_onset)), "%B %d"),
            # median_fall_depart=format(median(as.POSIXct(fall_mig_onset)), "%B %d"),
            stan_dev_fall_depart=signif(sd(fall_mig_onset), digits =0),
            earliest_fall_depart=format(range(fall_mig_onset)[1], "%B %d"),
            latest_fall_depart=format(range(fall_mig_onset)[2], "%B %d"))

fall_yearly %>% 
  flextable() %>% 
  set_header_labels(values=list(
    "fall_yr" = "Year",
    "num_swans" = "Number of Swans",
    "average_fall_depart" = "Average Fall Departure",
    "stan_dev_fall_depart" = "Standard Deviation (in days)",
    "earliest_fall_depart" = "Earliest Departure",
    "latest_fall_depart" = "Latest Departure")) %>% 
      set_table_properties(layout="autofit") %>% 
  vline(part="header") %>% 
  align(align ='center', part = 'all') %>% 
  bg(part="header", bg="#dbdbdb") %>% 
  bold(part="header") %>% 
  set_caption("Fall departures of long-distance migrants by year")
```

```{r spring-yearly-table}
# third round (post apr/may 2023)
param_df<-read_csv(here("output/migration_metrics_3rd.csv"))

# Merge additional info onto dataframe
ids<-read_csv(here("ids.csv"))
param_df<-param_df %>% 
  left_join(., ids,
            by=c("swan_ID" = "id")) %>% 
  select(-mate_present, -'mass (kg)', -'skull (mm)',-'tarsus (mm)', -comments) %>% 
  rename(breeding_status="breeding_status(if cygnets=breeder; if mate=paired;else non-breeder or cygnet)",
         id_year=year)


# Translate back to dates from julian day
p_dates<-param_df %>% 
  mutate(across(c(fall_mig_onset, 
                  first_departure,
                  furthest_seg_arrival, 
                  furthest_seg_departure, 
                  spring_arrival),
                ~ifelse(.<186, .+181, .-185)))


p_dates<-p_dates %>% 
  mutate(across(c(fall_mig_onset, 
                  first_departure,
                  furthest_seg_arrival, 
                  furthest_seg_departure, 
                  spring_arrival),
                ~as.Date(., origin="2019-12-31")))

# Add specific years for the fall and spring events (fall_onset and spring_arrival) to track yearly variation
p_dates<-p_dates %>% 
  mutate(fall_yr=map_chr(strsplit(.$id_year, "-"), ~.x[2]),
         spring_yr=map_chr(strsplit(.$id_year, "-"), ~.x[3]))

# add column for entire year cycle
p_dates<-p_dates %>% 
  mutate(entire_yr=paste(map_chr(strsplit(.$id_year, "-"), ~.x[2]),
                         map_chr(strsplit(.$id_year, "-"), ~.x[3]), sep="-"))

spring_yearly<-p_dates %>% 
  drop_na(spring_arrival) %>% 
  group_by(spring_yr) %>% 
  summarize(num_swans=length(unique(swan_ID)),
            average_spring_arrival=format(mean(as.POSIXct(spring_arrival)), "%B %d"),
            stan_dev_spring_arrival=signif(sd(spring_arrival), digits=0),
            earliest_spring_arrival=format(range(spring_arrival)[1], "%B %d"),
            latest_spring_arrival=format(range(spring_arrival)[2], "%B %d"))

spring_yearly %>% 
  flextable() %>% 
  set_header_labels(values=list(
    "spring_yr" = "Year",
    "num_swans" = "Number of Swans",
    "average_spring_arrival" = "Average Spring Arrival",
    "stan_dev_spring_arrival" = "Standard Deviation (in days)",
    "earliest_spring_arrival" = "Earliest Arrival",
    "latest_spring_arrival" = "Latest Arrival")) %>% 
  set_table_properties(layout="autofit") %>% 
  vline(part="header") %>% 
  align(align ='center', part = 'all') %>% 
  bg(part="header", bg="#dbdbdb") %>% 
  bold(part="header") %>% 
  set_caption("Spring arrivals of long-distance migrants by year")
```

```{r fall-breeding-table}
# third round (post apr/may 2023)
param_df<-read_csv(here("output/migration_metrics_3rd.csv"))

# Merge additional info onto dataframe
ids<-read_csv(here("ids.csv"))
param_df<-param_df %>% 
  left_join(., ids,
            by=c("swan_ID" = "id")) %>% 
  select(-mate_present, -'mass (kg)', -'skull (mm)',-'tarsus (mm)', -comments) %>% 
  rename(breeding_status="breeding_status(if cygnets=breeder; if mate=paired;else non-breeder or cygnet)",
         id_year=year)


# Translate back to dates from julian day
p_dates<-param_df %>% 
  mutate(across(c(fall_mig_onset, 
                  first_departure,
                  furthest_seg_arrival, 
                  furthest_seg_departure, 
                  spring_arrival),
                ~ifelse(.<186, .+181, .-185)))


p_dates<-p_dates %>% 
  mutate(across(c(fall_mig_onset, 
                  first_departure,
                  furthest_seg_arrival, 
                  furthest_seg_departure, 
                  spring_arrival),
                ~as.Date(., origin="2019-12-31")))

# Add specific years for the fall and spring events (fall_onset and spring_arrival) to track yearly variation
p_dates<-p_dates %>% 
  mutate(fall_yr=map_chr(strsplit(.$id_year, "-"), ~.x[2]),
         spring_yr=map_chr(strsplit(.$id_year, "-"), ~.x[3]))

# add column for entire year cycle
p_dates<-p_dates %>% 
  mutate(entire_yr=paste(map_chr(strsplit(.$id_year, "-"), ~.x[2]),
                         map_chr(strsplit(.$id_year, "-"), ~.x[3]), sep="-"))

# Split by breeding status
# Fall
p_dates %>% 
  drop_na(fall_mig_onset) %>% 
  drop_na(breeding_status) %>% 
  filter(breeding_status%in%c("breeder", "non_breeder", "paired")) %>%
  group_by(breeding_status) %>% 
  summarize(num_swans=length(unique(swan_ID)),
            num_swan_years=n(),
            average_fall_depart=format(mean(as.POSIXct(fall_mig_onset)), "%B %d"),
            # median_fall_depart=format(median(as.POSIXct(fall_mig_onset)), "%B %d"),
            stan_dev_fall_depart=signif(sd(fall_mig_onset), digits =0),
            earliest_fall_depart=format(range(fall_mig_onset)[1], "%B %d"),
            latest_fall_depart=format(range(fall_mig_onset)[2], "%B %d")) %>% 
  flextable() %>% 
  set_header_labels(values=list(
    "breeding_status" = "Breeding Status",
    "num_swans" = "Number of Swans",
    "num_swan_years" = "Number of Swan-Years",
    "average_fall_depart" = "Average Fall Departure",
    "stan_dev_fall_depart" = "Standard Deviation (in days)",
    "earliest_fall_depart" = "Earliest Departure",
    "latest_fall_depart" = "Latest Departure")) %>% 
  set_table_properties(layout="autofit") %>% 
  vline(part="header") %>% 
  align(align ='center', part = 'all') %>% 
  bg(part="header", bg="#dbdbdb") %>% 
  bold(part="header") %>% 
  set_caption("Fall departures of long-distance migrants by breeding status")
```

```{r spring-breeding-table}
# third round (post apr/may 2023)
param_df<-read_csv(here("output/migration_metrics_3rd.csv"))

# Merge additional info onto dataframe
ids<-read_csv(here("ids.csv"))
param_df<-param_df %>% 
  left_join(., ids,
            by=c("swan_ID" = "id")) %>% 
  select(-mate_present, -'mass (kg)', -'skull (mm)',-'tarsus (mm)', -comments) %>% 
  rename(breeding_status="breeding_status(if cygnets=breeder; if mate=paired;else non-breeder or cygnet)",
         id_year=year)


# Translate back to dates from julian day
p_dates<-param_df %>% 
  mutate(across(c(fall_mig_onset, 
                  first_departure,
                  furthest_seg_arrival, 
                  furthest_seg_departure, 
                  spring_arrival),
                ~ifelse(.<186, .+181, .-185)))


p_dates<-p_dates %>% 
  mutate(across(c(fall_mig_onset, 
                  first_departure,
                  furthest_seg_arrival, 
                  furthest_seg_departure, 
                  spring_arrival),
                ~as.Date(., origin="2019-12-31")))

# Add specific years for the fall and spring events (fall_onset and spring_arrival) to track yearly variation
p_dates<-p_dates %>% 
  mutate(fall_yr=map_chr(strsplit(.$id_year, "-"), ~.x[2]),
         spring_yr=map_chr(strsplit(.$id_year, "-"), ~.x[3]))

# add column for entire year cycle
p_dates<-p_dates %>% 
  mutate(entire_yr=paste(map_chr(strsplit(.$id_year, "-"), ~.x[2]),
                         map_chr(strsplit(.$id_year, "-"), ~.x[3]), sep="-"))

# Spring
p_dates %>% 
  drop_na(spring_arrival) %>% 
  drop_na(breeding_status) %>% 
  filter(breeding_status%in%c("breeder", "non_breeder", "paired")) %>%
  group_by(breeding_status) %>% 
  summarize(num_swans=length(unique(swan_ID)),
            num_swan_years=n(),
            average_spring_arrival=format(mean(as.POSIXct(spring_arrival)), "%B %d"),
            stan_dev_spring_arrival=signif(sd(spring_arrival), digits=0),
            earliest_spring_arrival=format(range(spring_arrival)[1], "%B %d"),
            latest_spring_arrival=format(range(spring_arrival)[2], "%B %d")) %>% 
  flextable() %>% 
  set_header_labels(values=list(
    "spring_yr" = "Year",
    "num_swans" = "Number of Swans",
    "num_swan_years" = "Number of Swan-Years",
    "average_spring_arrival" = "Average Spring Arrival",
    "stan_dev_spring_arrival" = "Standard Deviation (in days)",
    "earliest_spring_arrival" = "Earliest Arrival",
    "latest_spring_arrival" = "Latest Arrival")) %>% 
  set_table_properties(layout="autofit") %>% 
  vline(part="header") %>% 
  align(align ='center', part = 'all') %>% 
  bg(part="header", bg="#dbdbdb") %>% 
  bold(part="header") %>% 
  set_caption("Spring arrivals of long-distance migrants by breeding status")
```

## Discussion

### Summarize main take-aways and the bigger relevance

1)  the proportion of IP that is migratory and the extent of those movements,

2)  migration phenology,

3)  the role of breeding status and breeding location on annual movement patterns, and

4)  the degree of individual and population variability in migration patterns.

### More background on how migration is learned/passed along

Once established, the mechanisms that underlie transmission of migratory information between generations can be influenced both genetically and through social learning [@akesson2020].
For some species with short lifespans (e.g. songbirds), migration is considered innate and primarily due to genetics based on observations of individuals that complete their first migrations independently without parents or other conspecifics to guide them [@berthold1991].
For many species with long generation times and high levels of parental care, migration behavior is considered to be primarily passed on through social learning, although the amount of time required for information transfer is not well understood across species [@mueller2013].
Collective knowledge has been shown to accumulate over generations to drive migration patterns and improve efficiency in flocking species with socially learned migration behaviors, [@sasaki2017] although in reintroduced populations of Whooping Cranes (Grus americana) that were initially trained (i.e., learned) to migrate by following aircraft, migratory efficiency of flocks rapidly increased when older individuals were present [@mueller2013].

### Broader significance of IP partial migration

Potential contributing reasons for partial migration: - Spectrum of environmental conditions along the latitudinal gradient of IP breeding range\
- Anthropogenic interferences (feeding, artificial open water) - Potential delays due to initiation of migration trends for the first time in reintroduced areas being limited by intergenerational transfer of knowledge?
- Potential "lag effects" of genetic lineage from RMP vs PCP?

### Migration Segmentation methods

What others have done: -- Threshold-based (Rely on arbitrary choices, not generalizable to other species) - Date-based time threshold, distance-based spatial threshold, a combination of both -- Model-based (objective, but may not be very accurate) - traditional NSD Bunnefeld curve-fitting approach (and the Spitz migrateR package with slightly more flexibility) -- Hybrid approaches - Visual ID based on k-means clustering of distance and elevation [@lowrey2020; @zuckerman2023]

How our methods are different from others:

Our attempt at semi-automated analyses; if there is no human component there is an inevitable level of bias, but this can be reduced with a minimalist human component such as visually inspecting model fits and kicking out obviously bad fits.
By adopting a compromise between a purely automated and objective approach that may present more bias if asked to accommodate too much biological variability and a more Trying to consider migration as more of a continuum.

Net-Squared Displacement has been most commonly used to categorize migration by fitting a small number of non-linear theoretic movement models that represent traditional types of migration and choosing the movement model with the lowest AIC value [@bunnefeld2011; @spitz2017], a relatively straightforward approach, although some studies have shown that it often does not reliably identify migration at an individual level [@cagnacci2016].

Despite the prevalence of this approach, increasing evidence has been provided to suggest that the majority of migration doesn't fit into these restrictive categories and that migration should instead be considered along a continuous behavioral gradient [@ball2001; @dingle2007].
**Add comparison of our approach with [@vandekerk2021]**

## Acknowledgements

## References
